---
title: Análise de dados em R 
Author: Luiz Carlos Vieira
date: 22/02/2022
---

# Introdução

Laboratórios por todo o mundo estão sequenciando os genomas das mais diversas formas de vida na Terra. 
Porém mesmo com custos decrescendo rapidamente e enormes avanços tecnológicos no sequenciamento do genoma,
estamos vendo apenas um pequena parcela das informações biológicas contidas em cada célula, tecido, organismo
e ecossistema.

No entanto, esta "pequena parcela" das informações biológicas que estamos coletando equivalem a montanhas de 
dados com os quais os biólogos precisam trabalhar. Em nenhum outro momento da história da humanidade nossa 
capacidade de entender as complexidades da vida dependeu tanto de nossas habilidades para trabalhar e analisar
dados. E todo esse esforço em pesquisa precisa ser robusto e reproduzível.

Com isso, ferramentas que nos ajudem a analisar esses dados de forma eficiente, rápida, e fidedigna são essenciais
para garantir produção e reprodutibilidade das pesquisas. A exemplo destas ferramentas, temos as linguagem de 
programação R e python que possibilitam a manipulação de grande volume de dados. 



## Carregando a biblioteca built-in MASS
```{r}
library(MASS)
```


## Informações sobre o dataset

Visualizando o cabeçalho e rodapé do dataset cars93
```{r}
head(Cars93)  

tail(Cars93)
```

Visualizando o dataset Cars93 completo com View()
```{r}
View(Cars93)
```


Dimenssõeses do dataset Cars93
```{r}
dim(Cars93)
nrow(Cars93)
ncol(Cars93)
```


Estrutura do dataset
```{r}
str(Cars93)
```


Descrição estatística do dataset
```{r}
summary(Cars93)
```


## Uso do sinal $ para acessar colunas do dataset

O sinal de $ é usado para acessar colunas especificas do dataset.

Com o uso do $ acessamos os fatores de Drivetrain ("4WD" "Front" "Rear" )
```{r}
levels(Cars93$DriveTrain)

levels(Cars93$Man.trans.avail)
```


## Uso do with 

Com o with é possível realizar operações com subsets de um dataset.

somando as ocorrencias onde os valores correspondem a "USA" e 4 nas colunas Origen e cylinders 
```{r}
with(Cars93, sum(Origin == "USA" & Cylinders == 4))
```


## Subseting do dataset, 

Acessando as linhas 4 á 20
```{r}
Cars93[c(4:20),]
```
Caso escolha um subset com apenas uma linha e a estrutura do data frame não for mantida, set drop=FALSE.


Verificando se o subset, é um dataframe
```{r}
is.data.frame(Cars93[20,])
```


# Filtrando o df

Criando um filtro para carros com 6 cilindros
```{r}
filtro <- Cars93$Cylinders == 6
```


Aplicando o filtro ao dataset, retorna todas as linhas true para o filtro
```{r}
Cars93[filtro,]
```


Para que o filtro seja aplicado as linhas, é necessário usar ele ao lado esquerdo da vírgula [filtro , ]

Já que o primeiro valor passado ao [] corresponde as linhas.
```{r}
Cars93[Cars93$Cylinders == 6 & Cars93$EngineSize > 3, ] 

Cars93[Cars93$Cylinders == 6 & Cars93$Man.trans.avail == 'Yes', ]
```

# Explorando os dados e respondendo algumas perguntas sobre os dados

1 - Qual era a média de consumo dos carros na cidade em 93?
```{r}
CM_city <- mean(Cars93$MPG.city)

sprintf('O consumo médio na cidade dos carros em 93 era de %.2f MPG', CM_city)
```


2 - Qual era a média de consumo dos carros na estrada em 93?
```{r}
CM_Rod <- mean(Cars93$MPG.highway)

sprintf('O consumo médio na rodovía dos carros em 93 era de %.2f MPG', CM_Rod)
```

3 - Quantos modelos há no dataset?
```{r}
modelos <- unique(Cars93$Model)

length(modelos)

```


## Visualização dos dados

Carregando a liblioteca ggplot2, esta nos permite plotar gráficos com um alto grau de liberdade
para modificar os parâmetros
```{r}
library(ggplot2)
```


4 - Qual a relação entre Preço vs tipo de tração?
```{r}
qplot(data=Cars93, x= DriveTrain, y= Price, colour=I('blue'), size=I(3))
```


5 -  Há uma relação entre o maior preço para os caros automáticos com tração traseira?
```{r}
qplot(data=Cars93, x= DriveTrain, y= Price, colour=Man.trans.avail, size=I(3))
```


6 - Qual a relação entre o preço dos carros com a potência?
```{r}
plt1 <- ggplot(data = Cars93, aes(x=Price, y=Horsepower))

plt1 + geom_point() + xlab('Preço')
```
aes = Aesthetics.  Possui como atributo os valores dos eixos x e y, Colour, size, shape.

colour = quais conjunto dados usar para colorir.
size= quais conjunto e dados usar para controlar o tamanho dos pontos de dados.
shape = quais conjunto dados usar para distinguir o formato dos pontos de dados.

É possível inferir a partir dos dados, que carros com mais cavalos de potência são mais caros.


## Diferença entre estética e atributos em ggplot2

A estética é definida dentro de aes() na sintaxe do ggplot e os atributos estão fora de aes().

Por exemplo: ggplot (dados, aes(x, y, colour = var1) + geom_point (size = 6)
                    
Normalmente entendemos a estética como a aparência de algo como, cor, tamanho etc.

Mas em ggplot, a aparência das coisas é apenas um atributo.
                    
A estética não se refere à aparência de algo, mas à qual variável está mapeada nele.


## "Mapping" as variáveis horsepower e cylinder 

7 - O número de cilindros, influência nos preços e nos cavalos de potência
```{r}
plt2 <- ggplot(data = Cars93, aes(x=Price, y=Horsepower, colour=Cylinders))
plt2 + geom_point()

```


## "Mapping" das variáveis horsepower e cylinder, MPG.highway

8 - Uma maior a potência e um maior número de cilindros, influênciam nos preços e consumo de combustível?
```{r}
plt3 <- ggplot(data = Cars93, aes(x=Price, y=Horsepower, colour=Cylinders, size=MPG.highway))
plt3 + geom_point()
```


## Setting é diferente de mapping, pois se refere a aparência dos dados, e não ao mapping.

E não mapeando a largura dela para corresponder aos dados, como no exemplo anterior,
onde o tamanho dos cículos correspondem a distância. Maior distância, maior o tamanho dos círculos.

Neste exemplo, estou atribuindo a largura das linhas = 1.
```{r}

plt1 + geom_line(size=1)
plt2 + geom_line(size=1)

```

## Multiple plots

Para organizar vários gráficos ggplot2 na mesma página, as funções R padrão - par() e layout(), não funcionam.

Com isso a solução é usar o pacote gridExtra R, que vem com as função grid.arrange().

```{r}
grid.arrange(plt1 + geom_line(size=1), plt2 + geom_line(size=1), ncol=1)
```

## ggoubr e cowplot

A funções anterior mencionada grid.arrange não alinha os painéis de plotagem; em vez disso, os gráficos são
simplesmente colocados na grade como estão e, portanto, os eixos não são alinhados.

Caso um alinhamento do eixo dos plots for necessário, o pacote cowplot inclui a função plot_grid() 
com o argumento align.

Já função ggarrange() [no ggpubr],também possibilita o alinhamento dos plots com a função plot_grid(),
e ainda oferece uma solução para organizar vários ggplots em várias páginas. Ele também pode criar uma legenda
única comum para vários gráficos.

```{r}
library(cowplot)
library(ggpubr)
```


Função plot_grid do pacote cowplot
```{r}
plot_grid(plt1 + geom_line(size=1), plt2 + geom_line(size=1), 
          labels = c("A", "B"),
          ncol = 1, nrow = 2)
```


Função ggrange do pacote ggpubr
```{r}
ggarrange(plt1 + geom_line(size=1), plt2 + geom_line(size=1),
          labels = c("A", "B"),
          ncol = 1, nrow = 2)
```


## Anotação do plot com ggpubr
```{r}
figure <- ggarrange(plt1 + geom_line(size=1), plt2 + geom_line(size=1) +
                      font("x.text", size = 10),
                    ncol = 1, nrow = 2)

annotate_figure(figure,
                top = text_grob("Visualizing mpg", color = "red", face = "bold", size = 14),
                bottom = text_grob("Data source: \n mtcars data set", color = "blue",
                                   hjust = 1, x = 1, face = "italic", size = 10),
                left = text_grob("Figure arranged using ggpubr", color = "green", rot = 90),
                right = "I'm done, thanks :-)!",
                fig.lab = "Figure 1", fig.lab.face = "bold"
                )
```


9 - Qual a disdribuição dos preços?
```{r echo=FALSE, fig.height=10, fig.width=7.5, warning=FALSE}
pr <- ggplot(data = Cars93, aes(x=Price))


grid.arrange(pr + geom_histogram(binwidth =10),
             pr + geom_histogram(binwidth =10, aes(fill=Cylinders), colour='black'),
             pr + geom_density(aes(fill=Cylinders), position = 'stack'))
```

## Geom_smooth
```{r echo=FALSE, message=FALSE, warning=FALSE}
plot_grid(plt1 + geom_point() + geom_smooth(),
          plt1 + geom_point() + geom_smooth(fill=NA), 
          labels = c("A", "B"),
          ncol = 1, nrow = 2)
```


## Facets
```{r, fig.height=9, fig.width=7.5}
p1 <- pr + geom_histogram(binwidth =10, aes(fill=Cylinders), colour='black') + facet_grid(Cylinders~., scales = 'free')
          
p2 <- plt3 + geom_point() + facet_grid(Cylinders~., scales = 'free')
          
ggarrange(p1, p2 + font("x.text", size = 10),
          ncol = 1, nrow = 2)
```


## coordinates
```{r warning=FALSE}
plt2 + geom_point() + ylim(200,300)
```


## Zoom nos eixos dos gráficos
```{r}
plt2 + geom_point() + coord_cartesian(ylim = c(200,300))
```


# Themes

Abaixo um plot com os elementos textuais, totalamente fora do padrão de forma proposital,
para facilitar a observação das alterações causada por cada parâmetro no plot.
```{r}
plt_theme <- plt3 + geom_point() 

plt_theme + 
  ggtitle('Distribuição dos preços em relação a potência, cylindros e MPG') + 
  xlab('Potência') +
  ylab('Preço') +
  theme(plot.title = element_text(colour='DarkGreen', size=14, face='bold'),
        axis.title.x = element_text(colour = 'green', size = 18), 
        axis.title.y = element_text(colour = 'blue', size = 20),
        
        # elemento tick
        axis.text.x = element_text(size = 12),
        axis.text.y = element_text(size = 12),
        
        # legendas
        legend.title = element_text(colour = 'black', size = 8),
        legend.text = element_text(size=20))

```


## Referências:

https://www.r-graph-gallery.com/ggplot2-package.html
https://ggplot2.tidyverse.org/reference/ggplot.html
https://cran.rstudio.com/web/packages/gridExtra/vignettes/arrangeGrob.html
http://www.sthda.com/english/articles/24-ggpubr-publication-ready-plots/81-ggplot2-easy-way-to-mix-multiple-graphs-on-the-same-page/
https://r4ds.had.co.nz/index.html
https://www.w3schools.com/r/default.asp
https://www.cs.upc.edu/~robert/teaching/estadistica/rprogramming.pdf

